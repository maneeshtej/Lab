#include <mpi.h>
#include <stdio.h>


int main(int argc, char *argv[]) {


    MPI_Init(&argc, &argv);


    int rank, size;
    MPI_Comm_rank(MPI_COMM_WORLD, &rank);
    MPI_Comm_size(MPI_COMM_WORLD, &size);


    if (size < 2) {
        if (rank == 0) printf("Run with at least 2 processes\n");
        MPI_Finalize();
        return 0;
    }


    int send_val, recv_val;


    // ----------------------- Blocking Communication -----------------------
    if (rank == 0) {
        send_val = 100;
        printf("\n[Blocking] Rank 0 sending %d to Rank 1...\n", send_val);
        MPI_Send(&send_val, 1, MPI_INT, 1, 0, MPI_COMM_WORLD);
    }
    else if (rank == 1) {
        MPI_Recv(&recv_val, 1, MPI_INT, 0, 0, MPI_COMM_WORLD, MPI_STATUS_IGNORE);
        printf("[Blocking] Rank 1 received %d from Rank 0\n", recv_val);
    }


    MPI_Barrier(MPI_COMM_WORLD); // sync before non-blocking


    // ----------------------- Non-Blocking Communication -----------------------
    if (rank == 0) {
        send_val = 300;
        MPI_Request reqs[2];
        printf("\n[Non-Blocking] Rank 0 sending %d to Rank 1...\n", send_val);


        MPI_Isend(&send_val, 1, MPI_INT, 1, 0, MPI_COMM_WORLD, &reqs[0]);


        MPI_Waitall(2, reqs, MPI_STATUSES_IGNORE);
    }
    else if (rank == 1) {
        MPI_Request reqs[2];


        MPI_Irecv(&recv_val, 1, MPI_INT, 0, 0, MPI_COMM_WORLD, &reqs[0]);
        MPI_Wait(&reqs[0], MPI_STATUS_IGNORE);
        printf("[Non-Blocking] Rank 1 received %d from Rank 0\n", recv_val);


    }


    MPI_Finalize();
    return 0;
}


// mpicc program10.c -o program10
// mpirun -np 2 ./program10